<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Fun√ß√µes de ordem superior :: Eloquent JavaScript</title>
  <link rel=stylesheet href="js/node_modules/codemirror/lib/codemirror.css">
  <script src="js/acorn_codemirror.js"></script>
  <link rel=stylesheet href="css/ejs.css">
  <script src="js/sandbox.js"></script>
  <script src="js/ejs.js"></script>
  <script>var chapNum = 5;var sandboxLoadFiles = ["code/scripts.js","code/chapter/05_higher_order.js","code/intro.js"];
  </script>
</head>

<article>
<nav><a href="04_data.html" title="previous chapter">‚óÄ</a>¬†
  <a href="index.html" title="cover">‚óÜ</a>¬†<a href="06_object.html" title="next chapter">‚ñ∂</a>
</nav>

<h1><span class=chap_num>Chapter 5</span>Fun√ß√µes de ordem superior</h1>

<blockquote>

<p><a class="p_ident" id="p_tRZuZJdhzc" href="#p_tRZuZJdhzc" tabindex="-1" role="presentation"></a>Tzu-li e Tzu-ssu estavam se gabando do tamanho de seus programas mais recentes. ‚ÄúDuzentas mil linhas‚Äù, disse Tzu-li, ‚Äún√£o contando coment√°rios!‚Äù Tzu-ssu respondeu, ‚ÄúPssh, o meu √© quase <em>um milh√£o</em> de linhas j√°.‚Äù Master Yuan-Ma disse, ‚ÄúMeu melhor programa tem quinhentas linhas.‚Äù Ouvindo isso, Tzu-li e Tzu-ssu foram iluminados.</p>

<footer>Master Yuan-Ma, <cite>The Book of Programming</cite></footer>

</blockquote>

<blockquote>

<p><a class="p_ident" id="p_38/8EOO6D0" href="#p_38/8EOO6D0" tabindex="-1" role="presentation"></a>Existem duas maneiras de construir um design de software: Uma maneira √© torn√°-lo t√£o simples que obviamente n√£o h√° defici√™ncias, e a outra maneira √© torn√°-lo t√£o complicado que n√£o h√° defici√™ncias √≥bvias.</p>

<footer>C.A.R. Hoare, <cite>Palestra do Pr√™mio ACM Turing de 1980</cite></footer>

</blockquote><figure class="chapter true"><img src="img/chapter_picture_5.jpg" alt="Cartas de roteiros diferentes"></figure>

<p><a class="p_ident" id="p_lET9EkcayX" href="#p_lET9EkcayX" tabindex="-1" role="presentation"></a>Um programa grande √© um programa caro, e n√£o apenas pelo tempo que leva para construir. O tamanho quase sempre envolve complexidade e a complexidade confunde os programadores. Programadores confusos, por sua vez, introduzem erros (<em>bugs</em>) nos programas. Um programa grande fornece muito espa√ßo para esses bugs se esconderem, tornando-os dif√≠ceis de encontrar.</p>

<p><a class="p_ident" id="p_Nu9SLy1zSN" href="#p_Nu9SLy1zSN" tabindex="-1" role="presentation"></a>Vamos brevemente voltar aos dois √∫ltimos programas de exemplo na introdu√ß√£o. O primeiro √© independente e tem seis linhas de comprimento.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_uIkg9pj99q" href="#c_uIkg9pj99q" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">total</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">count</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;
<span class="cm-keyword">while</span> (<span class="cm-variable">count</span> <span class="cm-operator">&lt;=</span> <span class="cm-number">10</span>) {
  <span class="cm-variable">total</span> <span class="cm-operator">+=</span> <span class="cm-variable">count</span>;
  <span class="cm-variable">count</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span>;
}
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">total</span>);</pre>

<p><a class="p_ident" id="p_Fuu67nB6uy" href="#p_Fuu67nB6uy" tabindex="-1" role="presentation"></a>O segundo depende de duas fun√ß√µes externas e √© uma linha longa.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_KTbQMmMCli" href="#c_KTbQMmMCli" tabindex="-1" role="presentation"></a><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">sum</span>(<span class="cm-variable">range</span>(<span class="cm-number">1</span>, <span class="cm-number">10</span>)));</pre>

<p><a class="p_ident" id="p_Ax/ygVSziB" href="#p_Ax/ygVSziB" tabindex="-1" role="presentation"></a>Qual deles √© mais prov√°vel de conter um bug?</p>

<p><a class="p_ident" id="p_5gEOYjnEB6" href="#p_5gEOYjnEB6" tabindex="-1" role="presentation"></a>Se contarmos o tamanho das defini√ß√µes de <code>sum</code> e <code>range</code>, o segundo programa tamb√©m √© grande - at√© maior que o primeiro. Mas ainda assim, eu diria que √© mais prov√°vel que esteja correto.</p>

<p><a class="p_ident" id="p_ZN4kJ+g05H" href="#p_ZN4kJ+g05H" tabindex="-1" role="presentation"></a>√â mais prov√°vel que esteja correto porque a solu√ß√£o √© expressa em um vocabul√°rio que corresponde ao problema que est√° sendo resolvido. Somando um intervalo de n√∫meros n√£o √© sobre loops e contadores. √â sobre intervalos e somas.</p>

<p><a class="p_ident" id="p_f5bsaHWllj" href="#p_f5bsaHWllj" tabindex="-1" role="presentation"></a>As defini√ß√µes deste vocabul√°rio (as fun√ß√µes <code>sum</code> e<code>range</code>) ainda envolver√£o loops, contadores e outros detalhes incidentais. Mas como eles est√£o expressando conceitos mais simples que o programa como um todo, eles s√£o mais f√°ceis de acertar.</p>

<h2><a class="h_ident" id="h_wyHY2UMtYy" href="#h_wyHY2UMtYy" tabindex="-1" role="presentation"></a>Abstra√ß√£o</h2>

<p><a class="p_ident" id="p_RFVcAk5H1M" href="#p_RFVcAk5H1M" tabindex="-1" role="presentation"></a>No contexto da programa√ß√£o, esses tipos de vocabul√°rios s√£o geralmente chamados de <em>abstra√ß√µes</em>. As abstra√ß√µes ocultam detalhes e nos d√£o a capacidade de falar sobre problemas em um n√≠vel mais alto (ou mais abstrato).</p>

<p><a class="p_ident" id="p_/uO5xdZzCu" href="#p_/uO5xdZzCu" tabindex="-1" role="presentation"></a>Como analogia, compare estas duas receitas de sopa de ervilhas. O primeiro √© assim:</p>

<blockquote>

<p><a class="p_ident" id="p_nK2435n/ew" href="#p_nK2435n/ew" tabindex="-1" role="presentation"></a>Coloque 1 x√≠cara de ervilhas secas por pessoa em um recipiente. Adicione a √°gua at√© que as ervilhas estejam bem cobertas. Deixe as ervilhas na √°gua por pelo menos 12 horas. Retire as ervilhas da √°gua e coloque-as em uma panela. Adicione 4 x√≠caras de √°gua por pessoa. Cubra a panela e mantenha as ervilhas fervendo por duas horas. Tome meia cebola por pessoa. Corte em peda√ßos com uma faca. Adicione √†s ervilhas. Tome um talo de aipo por pessoa. Corte em peda√ßos com uma faca. Adicione √†s ervilhas. Tome uma cenoura por pessoa. Corte em peda√ßos. Com uma faca! Adicione √†s ervilhas. Cozinhe por mais 10 minutos.</p>

</blockquote>

<p><a class="p_ident" id="p_rylgq6CSI3" href="#p_rylgq6CSI3" tabindex="-1" role="presentation"></a>E esta √© a segunda receita:</p>

<blockquote>

<p><a class="p_ident" id="p_dIp38/Q3mL" href="#p_dIp38/Q3mL" tabindex="-1" role="presentation"></a>Por pessoa: 1 x√≠cara de ervilhas secas, metade de uma cebola picada, um talo de aipo e uma cenoura.</p>

<p><a class="p_ident" id="p_PxwxxOhX2k" href="#p_PxwxxOhX2k" tabindex="-1" role="presentation"></a>Mergulhe as ervilhas por 12 horas. Cozinhe por 2 horas em 4 x√≠caras de √°gua (por pessoa). Pique e adicione legumes. Cozinhe por mais 10 minutos.</p>

</blockquote>

<p><a class="p_ident" id="p_UwIJcPFu4n" href="#p_UwIJcPFu4n" tabindex="-1" role="presentation"></a>O segundo √© mais curto e mais f√°cil de interpretar. Mas voc√™ precisa entender algumas palavras relacionadas √† culin√°ria, como <em>mergulhar</em>, <em>cozinhar</em>, <em>picar</em> e, eu acho que, <em>legumes</em>.</p>

<p><a class="p_ident" id="p_or7OsdN7Y6" href="#p_or7OsdN7Y6" tabindex="-1" role="presentation"></a>Quando programamos, n√£o podemos confiar que todas as palavras que precisamos est√£o esperando por n√≥s no dicion√°rio. Assim, podemos cair no padr√£o da primeira receita - descobrir os passos precisos que o computador deve executar, um por um, cegos aos conceitos de alto n√≠vel que expressam.</p>

<p><a class="p_ident" id="p_yWEaAADK3y" href="#p_yWEaAADK3y" tabindex="-1" role="presentation"></a>√â uma habilidade √∫til, em programa√ß√£o, perceber quando voc√™ est√° trabalhando com um n√≠vel de abstra√ß√£o muito baixo.</p>

<h2><a class="h_ident" id="h_d9NLzi+Bp+" href="#h_d9NLzi+Bp+" tabindex="-1" role="presentation"></a>Repeti√ß√£o Abstrata</h2>

<p><a class="p_ident" id="p_lQxH/nrWii" href="#p_lQxH/nrWii" tabindex="-1" role="presentation"></a>Fun√ß√µes simples, como as vimos at√© agora, s√£o uma boa maneira de construir abstra√ß√µes. Mas √†s vezes eles entram em colapso.</p>

<p><a class="p_ident" id="p_3k1byYz3tv" href="#p_3k1byYz3tv" tabindex="-1" role="presentation"></a>√â comum que um programa fa√ßa algo por um determinado n√∫mero de vezes. Voc√™ pode escrever um <code>for</code> loop para isso, assim:</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_5c+C2+9IG1" href="#c_5c+C2+9IG1" tabindex="-1" role="presentation"></a><span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>) {
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">i</span>);
}</pre>

<p><a class="p_ident" id="p_mSytgQZ5ce" href="#p_mSytgQZ5ce" tabindex="-1" role="presentation"></a>Podemos abstrair ‚Äúfazendo algo <em>N</em> vezes‚Äù como uma fun√ß√£o? Bem, √© f√°cil escrever uma fun√ß√£o que chama <code>console.log</code> <em>N</em> vezes.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_/gKhlra9P+" href="#c_/gKhlra9P+" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">repeatLog</span>(<span class="cm-def">n</span>) {
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">n</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">i</span>);
  }
}</pre>

<p><a class="p_ident" id="p_4tYHYoXywa" href="#p_4tYHYoXywa" tabindex="-1" role="presentation"></a>Mas e se quisermos fazer algo diferente de registrar os n√∫meros? Como ‚Äúfazer algo‚Äù pode ser representado como uma fun√ß√£o e fun√ß√µes s√£o apenas valores, podemos passar nossa a√ß√£o como um valor de fun√ß√£o.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_p03rPqGmn9" href="#c_p03rPqGmn9" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">repeat</span>(<span class="cm-def">n</span>, <span class="cm-def">action</span>) {
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable-2">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">n</span>; <span class="cm-variable-2">i</span><span class="cm-operator">++</span>) {
    <span class="cm-variable-2">action</span>(<span class="cm-variable-2">i</span>);
  }
}

<span class="cm-variable">repeat</span>(<span class="cm-number">3</span>, <span class="cm-variable">console</span>.<span class="cm-property">log</span>);
<span class="cm-comment">// ‚Üí 0</span>
<span class="cm-comment">// ‚Üí 1</span>
<span class="cm-comment">// ‚Üí 2</span></pre>

<p><a class="p_ident" id="p_BHrbwWV8A4" href="#p_BHrbwWV8A4" tabindex="-1" role="presentation"></a>N√≥s n√£o temos que passar uma fun√ß√£o pr√©-definida para <code>repeat</code>. Geralmente, √© mais f√°cil criar um valor de fun√ß√£o no local.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_EiK2Y8M/Mh" href="#c_EiK2Y8M/Mh" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">labels</span> <span class="cm-operator">=</span> [];
<span class="cm-variable">repeat</span>(<span class="cm-number">5</span>, <span class="cm-def">i</span> <span class="cm-operator">=&gt;</span> {
  <span class="cm-variable">labels</span>.<span class="cm-property">push</span>(<span class="cm-string-2">`Unit ${</span><span class="cm-variable-2">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span><span class="cm-string-2">}</span><span class="cm-string-2">`</span>);
});
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">labels</span>);
<span class="cm-comment">// ‚Üí [&quot;Unit 1&quot;, &quot;Unit 2&quot;, &quot;Unit 3&quot;, &quot;Unit 4&quot;, &quot;Unit 5&quot;]</span></pre>

<p><a class="p_ident" id="p_4P8MVWVqtO" href="#p_4P8MVWVqtO" tabindex="-1" role="presentation"></a>Isto √© estruturado um pouco como um loop <code>for</code> - primeiro descreve o tipo de loop e, em seguida, fornece um corpo. No entanto, o corpo agora est√° escrito como um valor de fun√ß√£o, que √© colocado entre par√™nteses da chamada para <code>repeat</code>. √â por isso que ele deve ser fechado com a chave <em>e</em> o par√™ntese de fechamento. Em casos como este exemplo, onde o corpo √© uma express√£o pequena e √∫nica, voc√™ tamb√©m pode omitir as chaves e escrever o loop em uma √∫nica linha.</p>

<h2><a class="h_ident" id="h_+Pmg/Q9fwr" href="#h_+Pmg/Q9fwr" tabindex="-1" role="presentation"></a>Fun√ß√µes de ordem superior</h2>

<p><a class="p_ident" id="p_JzjN2u+KPJ" href="#p_JzjN2u+KPJ" tabindex="-1" role="presentation"></a>As fun√ß√µes que operam em outras fun√ß√µes, tomando-as como argumentos ou retornando-as, s√£o chamadas de fun√ß√µes de ordem superior. Como j√° vimos que as fun√ß√µes s√£o valores regulares, n√£o h√° nada particularmente not√°vel sobre o fato de que tais fun√ß√µes existem. O termo vem da matem√°tica, onde a distin√ß√£o entre fun√ß√µes e outros valores √© levada mais a s√©rio.</p>

<p><a class="p_ident" id="p_X+oxZgHwk4" href="#p_X+oxZgHwk4" tabindex="-1" role="presentation"></a>Fun√ß√µes de ordem superior nos permitem abstrair as <em>a√ß√µes</em>, n√£o apenas os valores. Elas v√™m em v√°rias formas. Por exemplo, podemos ter fun√ß√µes que criam novas fun√ß√µes.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_kHXugeV8Vn" href="#c_kHXugeV8Vn" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">greaterThan</span>(<span class="cm-def">n</span>) {
  <span class="cm-keyword">return</span> <span class="cm-def">m</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">m</span> <span class="cm-operator">&gt;</span> <span class="cm-variable-2">n</span>;
}
<span class="cm-keyword">let</span> <span class="cm-def">greaterThan10</span> <span class="cm-operator">=</span> <span class="cm-variable">greaterThan</span>(<span class="cm-number">10</span>);
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">greaterThan10</span>(<span class="cm-number">11</span>));
<span class="cm-comment">// ‚Üí true</span></pre>

<p><a class="p_ident" id="p_aSzVtmcJhE" href="#p_aSzVtmcJhE" tabindex="-1" role="presentation"></a>E podemos ter fun√ß√µes que mudam outras fun√ß√µes.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_17dfYaooPK" href="#c_17dfYaooPK" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">noisy</span>(<span class="cm-def">f</span>) {
  <span class="cm-keyword">return</span> (<span class="cm-meta">...</span><span class="cm-def">args</span>) <span class="cm-operator">=&gt;</span> {
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">&quot;calling with&quot;</span>, <span class="cm-variable-2">args</span>);
    <span class="cm-keyword">let</span> <span class="cm-def">result</span> <span class="cm-operator">=</span> <span class="cm-variable-2">f</span>(<span class="cm-meta">...</span><span class="cm-variable-2">args</span>);
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-string">&quot;called with&quot;</span>, <span class="cm-variable-2">args</span>, <span class="cm-string">&quot;, returned&quot;</span>, <span class="cm-variable-2">result</span>);
    <span class="cm-keyword">return</span> <span class="cm-variable-2">result</span>;
  };
}
<span class="cm-variable">noisy</span>(<span class="cm-variable">Math</span>.<span class="cm-property">min</span>)(<span class="cm-number">3</span>, <span class="cm-number">2</span>, <span class="cm-number">1</span>);
<span class="cm-comment">// ‚Üí calling with [3, 2, 1]</span>
<span class="cm-comment">// ‚Üí called with [3, 2, 1] , returned 1</span></pre>

<p><a class="p_ident" id="p_1n8Rm9Ld/t" href="#p_1n8Rm9Ld/t" tabindex="-1" role="presentation"></a>Podemos at√© escrever fun√ß√µes que fornecem novos tipos de fluxo de controle.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_of6iH06dyE" href="#c_of6iH06dyE" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">unless</span>(<span class="cm-def">test</span>, <span class="cm-def">then</span>) {
  <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable-2">test</span>) <span class="cm-variable-2">then</span>();
}

<span class="cm-variable">repeat</span>(<span class="cm-number">3</span>, <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> {
  <span class="cm-variable">unless</span>(<span class="cm-variable-2">n</span> <span class="cm-operator">%</span> <span class="cm-number">2</span> <span class="cm-operator">==</span> <span class="cm-number">1</span>, () <span class="cm-operator">=&gt;</span> {
    <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">n</span>, <span class="cm-string">&quot;is even&quot;</span>);
  });
});
<span class="cm-comment">// ‚Üí 0 is even</span>
<span class="cm-comment">// ‚Üí 2 is even</span></pre>

<p><a class="p_ident" id="p_9NqU4zEkWv" href="#p_9NqU4zEkWv" tabindex="-1" role="presentation"></a>Existe um m√©todo de array, <code>forEach</code>, que fornece algo como um loop <code>for</code>/<code>of</code> como uma fun√ß√£o de ordem superior.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_v9jL6NafRj" href="#c_v9jL6NafRj" tabindex="-1" role="presentation"></a>[<span class="cm-string">&quot;A&quot;</span>, <span class="cm-string">&quot;B&quot;</span>].<span class="cm-property">forEach</span>(<span class="cm-def">l</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable-2">l</span>));
<span class="cm-comment">// ‚Üí A</span>
<span class="cm-comment">// ‚Üí B</span></pre>

<h2><a class="h_ident" id="h_9RlDDFi3TN" href="#h_9RlDDFi3TN" tabindex="-1" role="presentation"></a>Conjunto de dados de script</h2>

<p><a class="p_ident" id="p_fbvXUqgu/D" href="#p_fbvXUqgu/D" tabindex="-1" role="presentation"></a>Uma √°rea onde as fun√ß√µes de ordem superior brilham √© o processamento de dados. Para processar dados, precisaremos de alguns dados reais. Este cap√≠tulo usar√° um conjunto de dados sobre scripts -sistemas de escrita como latim, cir√≠lico ou √°rabe.</p>

<p><a class="p_ident" id="p_AWMKVqD9wi" href="#p_AWMKVqD9wi" tabindex="-1" role="presentation"></a>Lembra do Unicode do <a href="01_values.html#unicode">Chapter 1</a>, o sistema que atribui um n√∫mero a cada caractere na linguagem escrita? A maioria desses caracteres est√° associada a um script espec√≠fico. O padr√£o cont√©m 140 scripts diferentes - 81 ainda est√£o em uso hoje e 59 s√£o hist√≥ricos.</p>

<p><a class="p_ident" id="p_bZ4cZDTgIn" href="#p_bZ4cZDTgIn" tabindex="-1" role="presentation"></a>Embora eu possa ler fluentemente apenas caracteres latinos, eu aprecio o fato de que as pessoas est√£o escrevendo textos em pelo menos 80 outros sistemas de escrita, muitos dos quais eu nem reconheceria. Por exemplo, aqui est√° uma amostra da caligrafia t√¢mil:</p><figure><img src="img/tamil.png" alt="Caligrafia t√¢mil"></figure>

<p><a class="p_ident" id="p_36dID65NZT" href="#p_36dID65NZT" tabindex="-1" role="presentation"></a>O conjunto de dados do exemplo cont√©m algumas informa√ß√µes sobre os 140 scripts definidos em Unicode. Est√° dispon√≠vel em <a href="https://eloquentjavascript.net/code#5">coding sandbox</a> para este cap√≠tulo vinculado a <code>SCRIPTS</code>. Este v√≠nculo cont√©m um array de objetos, cada um dos quais descreve um script.</p>

<pre class="snippet cm-s-default" data-language="application/json" ><a class="c_ident" id="c_YkfuyBG2fl" href="#c_YkfuyBG2fl" tabindex="-1" role="presentation"></a>{
  <span class="cm-property">name</span>: <span class="cm-string">&quot;Coptic&quot;</span>,
  <span class="cm-property">ranges</span>: [[<span class="cm-number">994</span>, <span class="cm-number">1008</span>], [<span class="cm-number">11392</span>, <span class="cm-number">11508</span>], [<span class="cm-number">11513</span>, <span class="cm-number">11520</span>]],
  <span class="cm-property">direction</span>: <span class="cm-string">&quot;ltr&quot;</span>,
  <span class="cm-property">year</span>: <span class="cm-operator">-</span><span class="cm-number">200</span>,
  <span class="cm-property">living</span>: <span class="cm-atom">false</span>,
  <span class="cm-property">link</span>: <span class="cm-string">&quot;https://en.wikipedia.org/wiki/Coptic_alphabet&quot;</span>
}</pre>

<p><a class="p_ident" id="p_F1+36l+59U" href="#p_F1+36l+59U" tabindex="-1" role="presentation"></a>Esse objeto nos informa o nome do script, os intervalos Unicode atribu√≠dos a ele, a dire√ß√£o na qual ele √© gravado, o tempo (aproximado) de origem, se ele ainda est√° em uso e um link para mais informa√ß√µes. A dire√ß√£o pode ser <code>&quot;ltr&quot;</code> da esquerda para a direita, <code>&quot;rtl&quot;</code> da direita para a esquerda (como o texto √°rabe e hebraico s√£o escritos), ou <code>&quot;ttb&quot;</code> de cima para baixo (como na escrita mongol).</p>

<p><a class="p_ident" id="p_RUJltr91r7" href="#p_RUJltr91r7" tabindex="-1" role="presentation"></a>A propriedade <code>ranges</code> cont√©m um array de intervalos de caracteres Unicode, cada um dos quais √© um array de dois elementos contendo um limite inferior e um limite superior. Quaisquer c√≥digos de caracteres dentro destes intervalos s√£o atribu√≠dos ao script. O limite inferior √© inclusivo (o c√≥digo 994 √© um caractere C√≥ptico), e o limite superior √© n√£o inclusivo (o c√≥digo 1008 n√£o √©).</p>

<h2><a class="h_ident" id="h_I4YmDSIP4I" href="#h_I4YmDSIP4I" tabindex="-1" role="presentation"></a>Filtrando Arrays</h2>

<p><a class="p_ident" id="p_qyV6T91Wld" href="#p_qyV6T91Wld" tabindex="-1" role="presentation"></a>Para encontrar os scripts no conjunto de dados que ainda est√£o em uso, a seguinte fun√ß√£o pode ser √∫til. Ela filtra os elementos de um array que n√£o passam em um teste.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_POEf7pMCk0" href="#c_POEf7pMCk0" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">filter</span>(<span class="cm-def">array</span>, <span class="cm-def">test</span>) {
  <span class="cm-keyword">let</span> <span class="cm-def">passed</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">element</span> <span class="cm-keyword">of</span> <span class="cm-variable-2">array</span>) {
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">test</span>(<span class="cm-variable-2">element</span>)) {
      <span class="cm-variable-2">passed</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">element</span>);
    }
  }
  <span class="cm-keyword">return</span> <span class="cm-variable-2">passed</span>;
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">filter</span>(<span class="cm-variable">SCRIPTS</span>, <span class="cm-def">script</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">script</span>.<span class="cm-property">living</span>));
<span class="cm-comment">// ‚Üí [{name: &quot;Adlam&quot;, ‚Ä¶}, ‚Ä¶]</span></pre>

<p><a class="p_ident" id="p_nKxuQ8pdwo" href="#p_nKxuQ8pdwo" tabindex="-1" role="presentation"></a>A fun√ß√£o usa o argumento chamado <code>test</code>, um valor de fun√ß√£o, para preencher uma ‚Äúlacuna‚Äù no c√°lculo - o processo de decidir quais elementos coletar.</p>

<p><a class="p_ident" id="p_FGbXd86uKh" href="#p_FGbXd86uKh" tabindex="-1" role="presentation"></a>Note como a fun√ß√£o <code>filter</code>, ao inv√©s de deletar elementos do array existente, constr√≥i um novo array com apenas os elementos que passam no teste. Esta fun√ß√£o √© <em>pura</em>. Ela n√£o modifica o array que lhe √© dado.</p>

<p><a class="p_ident" id="p_xp7BR0AqD8" href="#p_xp7BR0AqD8" tabindex="-1" role="presentation"></a>Como o <code>forEach</code>, o <code>filter</code> √© um m√©todo de array padr√£o. O exemplo definiu a fun√ß√£o apenas para mostrar o que ela faz internamente. A partir de agora, vamos us√°-la assim:</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_x8e0PmGGB1" href="#c_x8e0PmGGB1" tabindex="-1" role="presentation"></a><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">SCRIPTS</span>.<span class="cm-property">filter</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">direction</span> <span class="cm-operator">==</span> <span class="cm-string">&quot;ttb&quot;</span>));
<span class="cm-comment">// ‚Üí [{name: &quot;Mongolian&quot;, ‚Ä¶}, ‚Ä¶]</span></pre>

<h2 id="map"><a class="h_ident" id="h_uARMy4t0OP" href="#h_uARMy4t0OP" tabindex="-1" role="presentation"></a>Transformando com map</h2>

<p><a class="p_ident" id="p_7kq96d/BLC" href="#p_7kq96d/BLC" tabindex="-1" role="presentation"></a>Digamos que temos um array de objetos representando scripts, produzidos pela filtragem do array <code>SCRIPTS</code> de alguma forma. Mas n√≥s queremos um array de nomes, que √© mais f√°cil de inspecionar.</p>

<p><a class="p_ident" id="p_YssV4j3+vu" href="#p_YssV4j3+vu" tabindex="-1" role="presentation"></a>O m√©todo <code>map</code> transforma um array aplicando uma fun√ß√£o a todos os seus elementos e construindo um novo array a partir dos valores retornados. O novo array ter√° o mesmo comprimento que o array de entrada, mas seu conte√∫do ter√° sido <em>mapeado</em> para uma nova forma pela fun√ß√£o.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_03caQcQElo" href="#c_03caQcQElo" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">map</span>(<span class="cm-def">array</span>, <span class="cm-def">transform</span>) {
  <span class="cm-keyword">let</span> <span class="cm-def">mapped</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">element</span> <span class="cm-keyword">of</span> <span class="cm-variable-2">array</span>) {
    <span class="cm-variable-2">mapped</span>.<span class="cm-property">push</span>(<span class="cm-variable-2">transform</span>(<span class="cm-variable-2">element</span>));
  }
  <span class="cm-keyword">return</span> <span class="cm-variable-2">mapped</span>;
}

<span class="cm-keyword">let</span> <span class="cm-def">rtlScripts</span> <span class="cm-operator">=</span> <span class="cm-variable">SCRIPTS</span>.<span class="cm-property">filter</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">direction</span> <span class="cm-operator">==</span> <span class="cm-string">&quot;rtl&quot;</span>);
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">map</span>(<span class="cm-variable">rtlScripts</span>, <span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">name</span>));
<span class="cm-comment">// ‚Üí [&quot;Adlam&quot;, &quot;Arabic&quot;, &quot;Imperial Aramaic&quot;, ‚Ä¶]</span></pre>

<p><a class="p_ident" id="p_A5ahUfMl8N" href="#p_A5ahUfMl8N" tabindex="-1" role="presentation"></a>Como <code>forEach</code> e <code>filter</code>, <code>map</code> √© um m√©todo de array padr√£o.</p>

<h2><a class="h_ident" id="h_SMnEQlmfAw" href="#h_SMnEQlmfAw" tabindex="-1" role="presentation"></a>Compacta√ß√£o com reduce</h2>

<p><a class="p_ident" id="p_WODpNcVona" href="#p_WODpNcVona" tabindex="-1" role="presentation"></a>Outra coisa comum a fazer com arrays √© calcular um √∫nico valor a partir deles. Nosso exemplo recorrente, somando uma cole√ß√£o de n√∫meros, √© um exemplo disso. Outro exemplo √© encontrar o script com mais caracteres.</p>

<p><a class="p_ident" id="p_/Lq0VN6cWL" href="#p_/Lq0VN6cWL" tabindex="-1" role="presentation"></a>A opera√ß√£o de ordem superior que representa esse padr√£o √© chamada <em>reduce</em> (√†s vezes tamb√©m chamada <em>fold</em>). Ela constr√≥i um valor tomando repetidamente um √∫nico elemento do array e combinando-o com o valor atual. Ao somar n√∫meros, voc√™ deve come√ßar com o n√∫mero zero e, para cada elemento, adicionar isso √† soma.</p>

<p><a class="p_ident" id="p_QfXih/qXde" href="#p_QfXih/qXde" tabindex="-1" role="presentation"></a>Os par√¢metros do <code>reduce</code> s√£o, al√©m do array, uma fun√ß√£o de combina√ß√£o e um valor inicial. Esta fun√ß√£o √© um pouco menos simples que <code>filter</code> e <code>map</code>, ent√£o d√™ uma olhada nela:</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_k5GDHjqpSc" href="#c_k5GDHjqpSc" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">reduce</span>(<span class="cm-def">array</span>, <span class="cm-def">combine</span>, <span class="cm-def">start</span>) {
  <span class="cm-keyword">let</span> <span class="cm-def">current</span> <span class="cm-operator">=</span> <span class="cm-variable-2">start</span>;
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">element</span> <span class="cm-keyword">of</span> <span class="cm-variable-2">array</span>) {
    <span class="cm-variable-2">current</span> <span class="cm-operator">=</span> <span class="cm-variable-2">combine</span>(<span class="cm-variable-2">current</span>, <span class="cm-variable-2">element</span>);
  }
  <span class="cm-keyword">return</span> <span class="cm-variable-2">current</span>;
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">reduce</span>([<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>], (<span class="cm-def">a</span>, <span class="cm-def">b</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-variable-2">b</span>, <span class="cm-number">0</span>));
<span class="cm-comment">// ‚Üí 10</span></pre>

<p><a class="p_ident" id="p_obkJNX6NoC" href="#p_obkJNX6NoC" tabindex="-1" role="presentation"></a>O m√©todo padr√£o <code>reduce</code> do array, que naturalmente corresponde a esta fun√ß√£o, tem uma conveni√™ncia adicionada. Se seu array cont√©m pelo menos um elemento, voc√™ pode deixar de lado o argumento <code>start</code>. O m√©todo tomar√° o primeiro elemento do array como seu valor inicial e come√ßar√° a reduzir no segundo elemento.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_Dxn7muuMkk" href="#c_Dxn7muuMkk" tabindex="-1" role="presentation"></a><span class="cm-variable">console</span>.<span class="cm-property">log</span>([<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>].<span class="cm-property">reduce</span>((<span class="cm-def">a</span>, <span class="cm-def">b</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-variable-2">b</span>));
<span class="cm-comment">// ‚Üí 10</span></pre>

<p><a class="p_ident" id="p_M7jVFZEDc7" href="#p_M7jVFZEDc7" tabindex="-1" role="presentation"></a>Para usar o <code>reduce</code> (duas vezes) para encontrar o script com mais caracteres, podemos escrever algo assim:</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_x76Ukt5X+H" href="#c_x76Ukt5X+H" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">characterCount</span>(<span class="cm-def">script</span>) {
  <span class="cm-keyword">return</span> <span class="cm-variable-2">script</span>.<span class="cm-property">ranges</span>.<span class="cm-property">reduce</span>((<span class="cm-def">count</span>, [<span class="cm-def">from</span>, <span class="cm-def">to</span>]) <span class="cm-operator">=&gt;</span> {
    <span class="cm-keyword">return</span> <span class="cm-variable-2">count</span> <span class="cm-operator">+</span> (<span class="cm-variable-2">to</span> <span class="cm-operator">-</span> <span class="cm-variable-2">from</span>);
  }, <span class="cm-number">0</span>);
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">SCRIPTS</span>.<span class="cm-property">reduce</span>((<span class="cm-def">a</span>, <span class="cm-def">b</span>) <span class="cm-operator">=&gt;</span> {
  <span class="cm-keyword">return</span> <span class="cm-variable">characterCount</span>(<span class="cm-variable-2">a</span>) <span class="cm-operator">&lt;</span> <span class="cm-variable">characterCount</span>(<span class="cm-variable-2">b</span>) <span class="cm-operator">?</span> <span class="cm-variable-2">b</span> : <span class="cm-variable-2">a</span>;
}));
<span class="cm-comment">// ‚Üí {name: &quot;Han&quot;, ‚Ä¶}</span></pre>

<p><a class="p_ident" id="p_OqTluURAII" href="#p_OqTluURAII" tabindex="-1" role="presentation"></a>A fun√ß√£o <code>characterCount</code> reduz os intervalos atribu√≠dos a um script pela soma de seus tamanhos. Observe o uso da desestrutura√ß√£o na lista de par√¢metros da fun√ß√£o redutora. A segunda chamada para <code>reduce</code> ent√£o usa isso para encontrar o maior script, comparando repetidamente dois scripts e retornando o maior.</p>

<p><a class="p_ident" id="p_Z8fNsqJNQs" href="#p_Z8fNsqJNQs" tabindex="-1" role="presentation"></a>O script Han tem mais de 89.000 caracteres atribu√≠dos a ele no padr√£o Unicode, tornando-o de longe o maior sistema de escrita do conjunto de dados. Han √© um script (√†s vezes) usado para textos chineses, japoneses e coreanos. Esses idiomas compartilham muitos caracteres, embora tendam a escrev√™-los de forma diferente. O Unicode Consortium (baseado nos EUA) decidiu trat√°-los como um √∫nico sistema de escrita para salvar c√≥digos de caracteres. Isso √© chamado de <em>unifica√ß√£o Han</em> e ainda deixa algumas pessoas muito irritadas.</p>

<h2><a class="h_ident" id="h_iUCBZqG/mY" href="#h_iUCBZqG/mY" tabindex="-1" role="presentation"></a>Composi√ß√£o</h2>

<p><a class="p_ident" id="p_7oEOCDIhsG" href="#p_7oEOCDIhsG" tabindex="-1" role="presentation"></a>Considere como ter√≠amos escrito o exemplo anterior (encontrar o maior script) sem fun√ß√µes de ordem superior. O c√≥digo n√£o √© muito pior.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_1FmIKHNB24" href="#c_1FmIKHNB24" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">biggest</span> <span class="cm-operator">=</span> <span class="cm-atom">null</span>;
<span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">script</span> <span class="cm-keyword">of</span> <span class="cm-variable">SCRIPTS</span>) {
  <span class="cm-keyword">if</span> (<span class="cm-variable">biggest</span> <span class="cm-operator">==</span> <span class="cm-atom">null</span> <span class="cm-operator">|</span><span class="cm-operator">|</span>
      <span class="cm-variable">characterCount</span>(<span class="cm-variable">biggest</span>) <span class="cm-operator">&lt;</span> <span class="cm-variable">characterCount</span>(<span class="cm-variable">script</span>)) {
    <span class="cm-variable">biggest</span> <span class="cm-operator">=</span> <span class="cm-variable">script</span>;
  }
}
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">biggest</span>);
<span class="cm-comment">// ‚Üí {name: &quot;Han&quot;, ‚Ä¶}</span></pre>

<p><a class="p_ident" id="p_5e0Z3r4WJ6" href="#p_5e0Z3r4WJ6" tabindex="-1" role="presentation"></a>H√° mais algumas vincula√ß√µes, e o programa tem mais quatro linhas. Mas ainda √© muito leg√≠vel.</p>

<p id="average_function"><a class="p_ident" id="p_hR9ZHKASxH" href="#p_hR9ZHKASxH" tabindex="-1" role="presentation"></a>Fun√ß√µes de ordem superior come√ßam a brilhar quando voc√™ precisa <em>compor</em> opera√ß√µes. Como exemplo, vamos escrever um c√≥digo que encontre o ano m√©dio de origem para scripts vivos e mortos no conjunto de dados.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_rbnWPJoeJs" href="#c_rbnWPJoeJs" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">average</span>(<span class="cm-def">array</span>) {
  <span class="cm-keyword">return</span> <span class="cm-variable-2">array</span>.<span class="cm-property">reduce</span>((<span class="cm-def">a</span>, <span class="cm-def">b</span>) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">a</span> <span class="cm-operator">+</span> <span class="cm-variable-2">b</span>) <span class="cm-operator">/</span> <span class="cm-variable-2">array</span>.<span class="cm-property">length</span>;
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">Math</span>.<span class="cm-property">round</span>(<span class="cm-variable">average</span>(
  <span class="cm-variable">SCRIPTS</span>.<span class="cm-property">filter</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">living</span>).<span class="cm-property">map</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">year</span>))));
<span class="cm-comment">// ‚Üí 1188</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">Math</span>.<span class="cm-property">round</span>(<span class="cm-variable">average</span>(
  <span class="cm-variable">SCRIPTS</span>.<span class="cm-property">filter</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-operator">!</span><span class="cm-variable-2">s</span>.<span class="cm-property">living</span>).<span class="cm-property">map</span>(<span class="cm-def">s</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">s</span>.<span class="cm-property">year</span>))));
<span class="cm-comment">// ‚Üí 188</span></pre>

<p><a class="p_ident" id="p_1BL3RHIH4F" href="#p_1BL3RHIH4F" tabindex="-1" role="presentation"></a>Ent√£o os scripts mortos em Unicode s√£o, em m√©dia, mais velhos que os vivos. Esta n√£o √© uma estat√≠stica terrivelmente significativa ou surpreendente. Mas espero que voc√™ concorde que o c√≥digo usado para calcul√°-lo n√£o √© dif√≠cil de ler. Voc√™ pode v√™-lo como um pipeline: n√≥s come√ßamos com todos os scripts, filtramos os vivos (ou mortos), tiramos os anos deles, medimos a m√©dia deles e arredondamos o resultado.</p>

<p><a class="p_ident" id="p_uCkpjiu0hH" href="#p_uCkpjiu0hH" tabindex="-1" role="presentation"></a>Voc√™ poderia definitivamente tamb√©m escrever este c√°lculo como um grande loop.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_PumCVjaL6O" href="#c_PumCVjaL6O" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">total</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-def">count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;
<span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">script</span> <span class="cm-keyword">of</span> <span class="cm-variable">SCRIPTS</span>) {
  <span class="cm-keyword">if</span> (<span class="cm-variable">script</span>.<span class="cm-property">living</span>) {
    <span class="cm-variable">total</span> <span class="cm-operator">+=</span> <span class="cm-variable">script</span>.<span class="cm-property">year</span>;
    <span class="cm-variable">count</span> <span class="cm-operator">+=</span> <span class="cm-number">1</span>;
  }
}
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">Math</span>.<span class="cm-property">round</span>(<span class="cm-variable">total</span> <span class="cm-operator">/</span> <span class="cm-variable">count</span>));
<span class="cm-comment">// ‚Üí 1188</span></pre>

<p><a class="p_ident" id="p_A6Wqynx/db" href="#p_A6Wqynx/db" tabindex="-1" role="presentation"></a>Mas √© mais dif√≠cil ver o que estava a ser calculado e como. E porque os resultados intermedi√°rios n√£o s√£o representados como valores coerentes, seria muito mais trabalho extrair algo como <code>m√©dia</code> em uma fun√ß√£o separada.</p>

<p><a class="p_ident" id="p_cJinHhmmrc" href="#p_cJinHhmmrc" tabindex="-1" role="presentation"></a>Em termos do que o computador est√° realmente fazendo, estas duas abordagens tamb√©m s√£o bastante diferentes. A primeira ir√° construir novos arrays ao rodar <code>filter</code> e <code>map</code>, enquanto a segunda calcula apenas alguns n√∫meros, fazendo menos trabalho. Voc√™ pode normalmente usar a abordagem leg√≠vel, mas se voc√™ est√° processando arrays enormes, e fazendo muitas vezes, o estilo menos abstrato pode valer a pena pela velocidade extra.</p>

<h2><a class="h_ident" id="h_LybfOkHg+s" href="#h_LybfOkHg+s" tabindex="-1" role="presentation"></a>Strings e c√≥digos de caracteres</h2>

<p><a class="p_ident" id="p_z3s7NP5ycS" href="#p_z3s7NP5ycS" tabindex="-1" role="presentation"></a>Um uso do conjunto de dados seria descobrir qual script um peda√ßo de texto est√° usando. Vamos passar por um programa que faz isso.</p>

<p><a class="p_ident" id="p_ETaO3rVz84" href="#p_ETaO3rVz84" tabindex="-1" role="presentation"></a>Lembre-se que cada script tem um array de intervalos de c√≥digo de caracteres associados a ele. Portanto, dado um c√≥digo de caracteres, podemos usar uma fun√ß√£o como esta para encontrar o script correspondente (se houver):</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_Q8918ecfHn" href="#c_Q8918ecfHn" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">characterScript</span>(<span class="cm-def">code</span>) {
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">script</span> <span class="cm-keyword">of</span> <span class="cm-variable">SCRIPTS</span>) {
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">script</span>.<span class="cm-property">ranges</span>.<span class="cm-property">some</span>(([<span class="cm-def">from</span>, <span class="cm-def">to</span>]) <span class="cm-operator">=&gt;</span> {
      <span class="cm-keyword">return</span> <span class="cm-variable-2">code</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable-2">from</span> <span class="cm-operator">&amp;</span><span class="cm-operator">&amp;</span> <span class="cm-variable-2">code</span> <span class="cm-operator">&lt;</span> <span class="cm-variable-2">to</span>;
    })) {
      <span class="cm-keyword">return</span> <span class="cm-variable-2">script</span>;
    }
  }
  <span class="cm-keyword">return</span> <span class="cm-atom">null</span>;
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">characterScript</span>(<span class="cm-number">121</span>));
<span class="cm-comment">// ‚Üí {name: &quot;Latin&quot;, ‚Ä¶}</span></pre>

<p><a class="p_ident" id="p_loNA/OWjIR" href="#p_loNA/OWjIR" tabindex="-1" role="presentation"></a>O m√©todo <code>some</code> √© outra fun√ß√£o de ordem superior. Faz exame de uma fun√ß√£o do teste e diz-lhe se essa fun√ß√£o retorna verdadeiro para alguns dos elementos na disposi√ß√£o.</p>

<p id="code_units"><a class="p_ident" id="p_MQWIYzfBGl" href="#p_MQWIYzfBGl" tabindex="-1" role="presentation"></a>Mas como √© que arranjamos os c√≥digos de caracteres em uma string?</p>

<p><a class="p_ident" id="p_oTKIISmMsJ" href="#p_oTKIISmMsJ" tabindex="-1" role="presentation"></a>No <a href="01_values.html">Cap√≠tulo 1</a> eu mencionei que strings JavaScript s√£o codificadas como uma sequ√™ncia de n√∫meros de 16 bits. Estes s√£o chamados de <em>unidade de c√≥digos</em>. Um c√≥digo de caractere Unicode era inicialmente suposto caber dentro de tal unidade (o que lhe d√° um pouco mais de 65.000 caracteres). Quando ficou claro que isso n√£o seria suficiente, muitas pessoas se recusaram a usar mais mem√≥ria por caractere. Para resolver essas preocupa√ß√µes, UTF-16, o formato usado pelas strings JavaScript, foi inventado. Ele descreve os caracteres mais comuns usando uma √∫nica unidade de c√≥digo de 16 bits, mas usa um par de duas dessas unidades para outras.</p>

<p><a class="p_ident" id="p_R13JKbfcBV" href="#p_R13JKbfcBV" tabindex="-1" role="presentation"></a>O UTF-16 √© geralmente considerado uma m√° ideia hoje. Parece quase intencionalmente concebido para convidar erros. √â f√°cil escrever programas que fingem que as unidades de c√≥digo e os caracteres s√£o a mesma coisa. E se a sua linguagem n√£o usa caracteres de duas unidades, isso parecer√° funcionar muito bem. Mas assim que algu√©m tenta usar tal programa com alguns menos comuns caracteres chineses, ele quebra. Felizmente, com o advento do emoji, todos come√ßaram a usar caracteres de duas unidades, e o fardo de lidar com tais problemas √© mais justamente distribu√≠do.</p>

<p><a class="p_ident" id="p_0v+CsgpV2c" href="#p_0v+CsgpV2c" tabindex="-1" role="presentation"></a>Infelizmente, opera√ß√µes √≥bvias em strings JavaScript, como obter seu comprimento atrav√©s da propriedade <code>length</code> e acessar seu conte√∫do usando colchetes, lidam apenas com unidades de c√≥digo.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_9FpGi4EMF7" href="#c_9FpGi4EMF7" tabindex="-1" role="presentation"></a><span class="cm-comment">// Dois caracteres emoji, cavalo e sapato</span>
<span class="cm-keyword">let</span> <span class="cm-def">horseShoe</span> <span class="cm-operator">=</span> <span class="cm-string">&quot;üê¥üëü&quot;</span>;
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">horseShoe</span>.<span class="cm-property">length</span>);
<span class="cm-comment">// ‚Üí 4</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">horseShoe</span>[<span class="cm-number">0</span>]);
<span class="cm-comment">// ‚Üí (Caractere do meio inv√°lido)</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">horseShoe</span>.<span class="cm-property">charCodeAt</span>(<span class="cm-number">0</span>));
<span class="cm-comment">// ‚Üí 55357 (C√≥digo do caractere do meio)</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">horseShoe</span>.<span class="cm-property">codePointAt</span>(<span class="cm-number">0</span>));
<span class="cm-comment">// ‚Üí 128052 (C√≥digo atual para emoji de cavalo)</span></pre>

<p><a class="p_ident" id="p_lINHo/twwY" href="#p_lINHo/twwY" tabindex="-1" role="presentation"></a>O m√©todo <code>charCodeAt</code> do JavaScript lhe d√° uma unidade de c√≥digo, n√£o um c√≥digo de caracteres completo. O m√©todo <code>codePointAt</code>, adicionado mais tarde, d√° um caractere Unicode completo. Ent√£o n√≥s poder√≠amos usar isso para obter caracteres de uma string. Mas o argumento passado para <code>codePointAt</code> ainda √© um √≠ndice na sequ√™ncia de unidades de c√≥digo. Ent√£o, para executar todos os caracteres em uma string, n√≥s ainda precisamos lidar com a quest√£o de se um caractere ocupa uma ou duas unidades de c√≥digo.</p>

<p><a class="p_ident" id="p_x2v5E9QXM7" href="#p_x2v5E9QXM7" tabindex="-1" role="presentation"></a>No <a href="04_data.html#for_of_loop">cap√≠tulo anterior</a>, eu mencionei que um loop <code>for</code>/<code>of</code> tamb√©m pode ser usado em strings. Como o <code>codePointAt</code>, este tipo de loop foi introduzido em um momento em que as pessoas estavam bem cientes dos problemas com UTF-16. Quando voc√™ o usa para fazer um loop sobre uma string, ele lhe d√° caracteres reais, n√£o unidades de c√≥digo.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_9QIfA1qjtG" href="#c_9QIfA1qjtG" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">roseDragon</span> <span class="cm-operator">=</span> <span class="cm-string">&quot;üåπüêâ&quot;</span>;
<span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">char</span> <span class="cm-keyword">of</span> <span class="cm-variable">roseDragon</span>) {
  <span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">char</span>);
}
<span class="cm-comment">// ‚Üí üåπ</span>
<span class="cm-comment">// ‚Üí üêâ</span></pre>

<p><a class="p_ident" id="p_dqn68j1Zwn" href="#p_dqn68j1Zwn" tabindex="-1" role="presentation"></a>Se voc√™ tem um caractere (que ser√° uma string de uma ou duas unidades de c√≥digo), voc√™ pode usar <code>codePointAt(0)</code> para obter seu c√≥digo.</p>

<h2><a class="h_ident" id="h_Nz5jG9Djwo" href="#h_Nz5jG9Djwo" tabindex="-1" role="presentation"></a>Reconhecendo o texto</h2>

<p><a class="p_ident" id="p_hxiKaZDS61" href="#p_hxiKaZDS61" tabindex="-1" role="presentation"></a>N√≥s temos uma fun√ß√£o <code>characterScript</code> e uma maneira de fazer um loop correto sobre os caracteres. O pr√≥ximo passo √© contar os caracteres que pertencem a cada script. A seguinte abstra√ß√£o de contagem ser√° √∫til aqui:</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_nau/OQcf6J" href="#c_nau/OQcf6J" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">countBy</span>(<span class="cm-def">items</span>, <span class="cm-def">groupName</span>) {
  <span class="cm-keyword">let</span> <span class="cm-def">counts</span> <span class="cm-operator">=</span> [];
  <span class="cm-keyword">for</span> (<span class="cm-keyword">let</span> <span class="cm-def">item</span> <span class="cm-keyword">of</span> <span class="cm-variable-2">items</span>) {
    <span class="cm-keyword">let</span> <span class="cm-def">name</span> <span class="cm-operator">=</span> <span class="cm-variable-2">groupName</span>(<span class="cm-variable-2">item</span>);
    <span class="cm-keyword">let</span> <span class="cm-def">known</span> <span class="cm-operator">=</span> <span class="cm-variable-2">counts</span>.<span class="cm-property">findIndex</span>(<span class="cm-def">c</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">c</span>.<span class="cm-property">name</span> <span class="cm-operator">==</span> <span class="cm-variable-2">name</span>);
    <span class="cm-keyword">if</span> (<span class="cm-variable-2">known</span> <span class="cm-operator">==</span> <span class="cm-operator">-</span><span class="cm-number">1</span>) {
      <span class="cm-variable-2">counts</span>.<span class="cm-property">push</span>({<span class="cm-property">name</span>, <span class="cm-property">count</span>: <span class="cm-number">1</span>});
    } <span class="cm-keyword">else</span> {
      <span class="cm-variable-2">counts</span>[<span class="cm-variable-2">known</span>].<span class="cm-property">count</span><span class="cm-operator">++</span>;
    }
  }
  <span class="cm-keyword">return</span> <span class="cm-variable-2">counts</span>;
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">countBy</span>([<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>, <span class="cm-number">4</span>, <span class="cm-number">5</span>], <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">&gt;</span> <span class="cm-number">2</span>));
<span class="cm-comment">// ‚Üí [{name: false, count: 2}, {name: true, count: 3}]</span></pre>

<p><a class="p_ident" id="p_YXsiExQEIn" href="#p_YXsiExQEIn" tabindex="-1" role="presentation"></a>A fun√ß√£o <code>countBy</code> espera uma cole√ß√£o (qualquer coisa que n√≥s podemos fazer loop com <code>for</code>/<code>of</code>) e uma fun√ß√£o que calcula um nome de grupo para um determinado elemento. Ele retorna um array de objetos, cada um dos quais nomeia um grupo e informa o n√∫mero de elementos que foram encontrados nesse grupo.</p>

<p><a class="p_ident" id="p_TPBGIqUxDw" href="#p_TPBGIqUxDw" tabindex="-1" role="presentation"></a>Ele usa outro m√©todo de array - o <code>findIndex</code>. Este m√©todo √© um pouco como <code>indexOf</code>, mas ao inv√©s de procurar por um valor espec√≠fico, ele encontra o primeiro valor para o qual a fun√ß√£o retorna <code>true</code>. Como <code>indexOf</code>, ele retorna -1 quando nenhum desses elementos √© encontrado.</p>

<p><a class="p_ident" id="p_E2J9W9DJSW" href="#p_E2J9W9DJSW" tabindex="-1" role="presentation"></a>Usando <code>countBy</code>, podemos escrever a fun√ß√£o que nos diz quais scripts s√£o usados em um peda√ßo de texto.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_TyAeKAD0HB" href="#c_TyAeKAD0HB" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">textScripts</span>(<span class="cm-def">text</span>) {
  <span class="cm-keyword">let</span> <span class="cm-def">scripts</span> <span class="cm-operator">=</span> <span class="cm-variable">countBy</span>(<span class="cm-variable-2">text</span>, <span class="cm-def">char</span> <span class="cm-operator">=&gt;</span> {
    <span class="cm-keyword">let</span> <span class="cm-def">script</span> <span class="cm-operator">=</span> <span class="cm-variable">characterScript</span>(<span class="cm-variable-2">char</span>.<span class="cm-property">codePointAt</span>(<span class="cm-number">0</span>));
    <span class="cm-keyword">return</span> <span class="cm-variable-2">script</span> <span class="cm-operator">?</span> <span class="cm-variable-2">script</span>.<span class="cm-property">name</span> : <span class="cm-string">&quot;none&quot;</span>;
  }).<span class="cm-property">filter</span>(({<span class="cm-def">name</span>}) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">name</span> <span class="cm-operator">!=</span> <span class="cm-string">&quot;none&quot;</span>);

  <span class="cm-keyword">let</span> <span class="cm-def">total</span> <span class="cm-operator">=</span> <span class="cm-variable-2">scripts</span>.<span class="cm-property">reduce</span>((<span class="cm-def">n</span>, {<span class="cm-def">count</span>}) <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">+</span> <span class="cm-variable-2">count</span>, <span class="cm-number">0</span>);
  <span class="cm-keyword">if</span> (<span class="cm-variable-2">total</span> <span class="cm-operator">==</span> <span class="cm-number">0</span>) <span class="cm-keyword">return</span> <span class="cm-string">&quot;No scripts found&quot;</span>;

  <span class="cm-keyword">return</span> <span class="cm-variable-2">scripts</span>.<span class="cm-property">map</span>(({<span class="cm-def">name</span>, <span class="cm-def">count</span>}) <span class="cm-operator">=&gt;</span> {
    <span class="cm-keyword">return</span> <span class="cm-string-2">`${</span><span class="cm-variable">Math</span>.<span class="cm-property">round</span>(<span class="cm-variable-2">count</span> <span class="cm-operator">*</span> <span class="cm-number">100</span> <span class="cm-operator">/</span> <span class="cm-variable-2">total</span>)<span class="cm-string-2">}</span><span class="cm-string-2">% ${</span><span class="cm-variable-2">name</span><span class="cm-string-2">}</span><span class="cm-string-2">`</span>;
  }).<span class="cm-property">join</span>(<span class="cm-string">&quot;, &quot;</span>);
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">textScripts</span>(<span class="cm-string">'Ëã±ÂõΩÁöÑÁãóËØ¥&quot;woof&quot;, ‰øÑÁΩóÊñØÁöÑÁãóËØ¥&quot;—Ç—è–≤&quot;'</span>));
<span class="cm-comment">// ‚Üí 61% Han, 22% Latin, 17% Cyrillic</span></pre>

<p><a class="p_ident" id="p_a717ratUvH" href="#p_a717ratUvH" tabindex="-1" role="presentation"></a>A fun√ß√£o primeiro conta os caracteres pelo nome e usa <code>characterScript</code> para atribuir-lhes um nome, retornando a string <code>&quot;none&quot;</code> para caracteres que n√£o fazem parte de nenhum script. A chamada <code>filter</code> remove a entrada <code>&quot;none&quot;</code> do array resultante, j√° que n√£o estamos interessados nesses caracteres.</p>

<p><a class="p_ident" id="p_t0fWoX8Wk8" href="#p_t0fWoX8Wk8" tabindex="-1" role="presentation"></a>Para podermos calcular porcentagem, precisamos primeiro do n√∫mero total de caracteres que pertencem a um script, que podemos calcular com <code>reduce</code>. Se tais caracteres n√£o forem encontrados, a fun√ß√£o retorna uma string espec√≠fica. Caso contr√°rio, ela transforma as entradas de contagem em strings leg√≠veis com <code>map</code> e ent√£o as combina com <code>join</code>.</p>

<h2><a class="h_ident" id="h_741R75mvqx" href="#h_741R75mvqx" tabindex="-1" role="presentation"></a>Resumo</h2>

<p><a class="p_ident" id="p_7Jo3fi0vB3" href="#p_7Jo3fi0vB3" tabindex="-1" role="presentation"></a>Ser capaz de passar valores de fun√ß√µes para outras fun√ß√µes √© um aspecto profundamente √∫til do JavaScript. Permite-nos escrever fun√ß√µes que modelam c√°lculos com ‚Äúlacunas‚Äù nelas. O c√≥digo que chama essas fun√ß√µes pode preencher as lacunas, fornecendo valores de fun√ß√£o.</p>

<p><a class="p_ident" id="p_YDikqjyub8" href="#p_YDikqjyub8" tabindex="-1" role="presentation"></a>Arrays fornecem uma s√©rie de m√©todos √∫teis de ordem superior. Voc√™ pode usar o <code>forEach</code> para fazer um loop sobre os elementos de um array. O m√©todo <code>filter</code> retorna um novo array contendo apenas os elementos que passam pela fun√ß√£o predicada. Transformar um array colocando cada elemento atrav√©s de uma fun√ß√£o √© feito com <code>map</code>. Voc√™ pode usar <code>reduce</code> para combinar todos os elementos de um array em um √∫nico valor. O m√©todo <code>some</code> testa se qualquer elemento corresponde a uma determinada fun√ß√£o predicada. E o <code>findIndex</code> encontra a posi√ß√£o do primeiro elemento que corresponde a um predicado.</p>

<h2><a class="h_ident" id="h_0CpJUZuhQJ" href="#h_0CpJUZuhQJ" tabindex="-1" role="presentation"></a>Exerc√≠cios</h2>

<h3><a class="i_ident" id="i_nND53pez/n" href="#i_nND53pez/n" tabindex="-1" role="presentation"></a>Achatamento</h3>

<p><a class="p_ident" id="p_tPT1ZaWo0c" href="#p_tPT1ZaWo0c" tabindex="-1" role="presentation"></a>Use o m√©todo <code>reduce</code> em combina√ß√£o com o m√©todo <code>concat</code> para ‚Äúachatar‚Äù um array de arrays em um √∫nico array que tenha todos os elementos dos arrays originais.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_wnM+mYe4pN" href="#c_wnM+mYe4pN" tabindex="-1" role="presentation"></a><span class="cm-keyword">let</span> <span class="cm-def">arrays</span> <span class="cm-operator">=</span> [[<span class="cm-number">1</span>, <span class="cm-number">2</span>, <span class="cm-number">3</span>], [<span class="cm-number">4</span>, <span class="cm-number">5</span>], [<span class="cm-number">6</span>]];
<span class="cm-comment">// O seu c√≥digo aqui.</span>
<span class="cm-comment">// ‚Üí [1, 2, 3, 4, 5, 6]</span></pre>

<h3><a class="i_ident" id="i_/QPN5J/EdM" href="#i_/QPN5J/EdM" tabindex="-1" role="presentation"></a>Seu pr√≥prio loop</h3>

<p><a class="p_ident" id="p_KXUMk9a9Po" href="#p_KXUMk9a9Po" tabindex="-1" role="presentation"></a>Escreva uma fun√ß√£o de ordem superior <code>loop</code> que fornece algo como uma instru√ß√£o de loop <code>for</code>. √â preciso um valor, uma fun√ß√£o de teste, uma fun√ß√£o de atualiza√ß√£o e uma fun√ß√£o estrutural. Cada itera√ß√£o, primeiro executa a fun√ß√£o de teste sobre o valor do loop atual e para se este retornar falso. Depois chama a fun√ß√£o estrutural, dando-lhe o valor atual. Finalmente, ele chama a fun√ß√£o de atualiza√ß√£o para criar um novo valor e come√ßa desde o in√≠cio.</p>

<p><a class="p_ident" id="p_HfyVQrYXHT" href="#p_HfyVQrYXHT" tabindex="-1" role="presentation"></a>Ao definir a fun√ß√£o, voc√™ pode usar um loop regular para fazer o looping real.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_vXY2omavPE" href="#c_vXY2omavPE" tabindex="-1" role="presentation"></a><span class="cm-comment">// O seu c√≥digo aqui.</span>

<span class="cm-variable">loop</span>(<span class="cm-number">3</span>, <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>, <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>, <span class="cm-variable">console</span>.<span class="cm-property">log</span>);
<span class="cm-comment">// ‚Üí 3</span>
<span class="cm-comment">// ‚Üí 2</span>
<span class="cm-comment">// ‚Üí 1</span></pre>

<h3><a class="i_ident" id="i_pBFKg/TGsD" href="#i_pBFKg/TGsD" tabindex="-1" role="presentation"></a>Todos</h3>

<p><a class="p_ident" id="p_fPpKpjdPPH" href="#p_fPpKpjdPPH" tabindex="-1" role="presentation"></a>An√°logo ao m√©todo <code>some</code>, arrays tamb√©m t√™m um m√©todo <code>every</code>. Este retorna <code>true</code> quando a fun√ß√£o dada retorna verdadeiro para <em>todos</em> os elementos do array. De certa forma, <code>some</code> √© uma vers√£o do operador <code>||</code> que atua em arrays, e <code>every</code> √© como o operador <code>&amp;&amp;</code>.</p>

<p><a class="p_ident" id="p_32g/KDVa2D" href="#p_32g/KDVa2D" tabindex="-1" role="presentation"></a>Implemente <code>every</code> como uma fun√ß√£o que usa um array e uma fun√ß√£o predicada como par√¢metros. Escreva duas vers√µes, uma usando um loop e outra usando o m√©todo <code>some</code>.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_Q/a5fbKc1L" href="#c_Q/a5fbKc1L" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">every</span>(<span class="cm-def">array</span>, <span class="cm-def">test</span>) {
  <span class="cm-comment">// O seu c√≥digo aqui.</span>
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">every</span>([<span class="cm-number">1</span>, <span class="cm-number">3</span>, <span class="cm-number">5</span>], <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>));
<span class="cm-comment">// ‚Üí true</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">every</span>([<span class="cm-number">2</span>, <span class="cm-number">4</span>, <span class="cm-number">16</span>], <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>));
<span class="cm-comment">// ‚Üí false</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">every</span>([], <span class="cm-def">n</span> <span class="cm-operator">=&gt;</span> <span class="cm-variable-2">n</span> <span class="cm-operator">&lt;</span> <span class="cm-number">10</span>));
<span class="cm-comment">// ‚Üí true</span></pre>

<div class="solution"><div class="solution-text">

<p><a class="p_ident" id="p_pm/XLH6X2x" href="#p_pm/XLH6X2x" tabindex="-1" role="presentation"></a>Como o operador <code>&amp;&amp;</code>, o m√©todo <code>every</code> pode parar de avaliar elementos adicionais assim que encontrar um que n√£o corresponda. Assim, a vers√£o baseada em loop pode saltar para fora do loop - com <code>break</code> ou <code>return</code> - assim que ele for executado em um elemento para o qual a fun√ß√£o predicada retorna <code>false</code>. Se o loop for executado at√© o fim sem encontrar tal elemento, n√≥s sabemos que todos os elementos coincidem e devemos retornar <code>true</code>.</p>

<p><a class="p_ident" id="p_gLzbYeDlpy" href="#p_gLzbYeDlpy" tabindex="-1" role="presentation"></a>Para compilar <code>every</code> em cima de <code>some</code>, podemos aplicar as  <em>leis de De Morgan</em>, que declara que <code>a &amp;&amp; b</code> √© igual a <code>!(!a || !b)</code>. Isso pode ser generalizado para arrays, onde todos os elementos no array correspondem se n√£o houver nenhum elemento no array que n√£o corresponda.</p>

</div></div>

<h3><a class="i_ident" id="i_3Xl5FeSNjL" href="#i_3Xl5FeSNjL" tabindex="-1" role="presentation"></a>Dire√ß√£o de escrita dominante</h3>

<p><a class="p_ident" id="p_riUzOyVcke" href="#p_riUzOyVcke" tabindex="-1" role="presentation"></a>Escreva uma fun√ß√£o que calcula a dire√ß√£o de escrita dominante numa cadeia de texto. Lembre-se que cada objeto script tem uma propriedade <code>direction</code> que pode ser <code>&quot;ltr&quot;</code>(esquerda para direita), <code>&quot;rtl&quot;</code>(direita para esquerda), ou <code>&quot;ttb&quot;</code>(de cima para baixo).</p>

<p><a class="p_ident" id="p_ndtfE0Hx/W" href="#p_ndtfE0Hx/W" tabindex="-1" role="presentation"></a>A dire√ß√£o dominante √© a dire√ß√£o da maioria dos caracteres que t√™m um script associado a eles. As fun√ß√µes <code>characterScript</code> e <code>countBy</code> definidas anteriormente no cap√≠tulo s√£o provavelmente √∫teis aqui.</p>

<pre class="snippet cm-s-default" data-language="javascript" ><a class="c_ident" id="c_xda6D4Cr5R" href="#c_xda6D4Cr5R" tabindex="-1" role="presentation"></a><span class="cm-keyword">function</span> <span class="cm-def">dominantDirection</span>(<span class="cm-def">text</span>) {
  <span class="cm-comment">// O seu c√≥digo aqui.</span>
}

<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">dominantDirection</span>(<span class="cm-string">&quot;Hello!&quot;</span>));
<span class="cm-comment">// ‚Üí ltr</span>
<span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">dominantDirection</span>(<span class="cm-string">&quot;Hey, ŸÖÿ≥ÿßÿ° ÿßŸÑÿÆŸäÿ±&quot;</span>));
<span class="cm-comment">// ‚Üí rtl</span></pre>

<div class="solution"><div class="solution-text">

<p><a class="p_ident" id="p_eyHKdXYNHk" href="#p_eyHKdXYNHk" tabindex="-1" role="presentation"></a>Sua solu√ß√£o pode se parecer muito com a primeira metade do exemplo <code>textScripts</code>. Voc√™ novamente tem que contar caracteres por um crit√©rio baseado no <code>characterScript</code> e ent√£o filtrar a parte do resultado que se refere a caracteres desinteressantes (sem script).</p>

<p><a class="p_ident" id="p_XrARyO9dd+" href="#p_XrARyO9dd+" tabindex="-1" role="presentation"></a>Encontrar a dire√ß√£o com a maior contagem de caracteres pode ser feito com <code>reduce</code>. Se n√£o estiver claro como, consulte o exemplo anterior no cap√≠tulo, aqui <code>reduce</code> foi usado para encontrar o script com mais caracteres.</p>

</div></div>

<nav><a href="04_data.html" title="previous chapter">‚óÄ</a>¬†
  <a href="index.html" title="cover">‚óÜ</a>¬†<a href="06_object.html" title="next chapter">‚ñ∂</a>
</nav>
</article>
